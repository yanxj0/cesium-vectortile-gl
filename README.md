### ğŸŒ **cesium-vectortile-gl**

**cesium-vectortile-gl** æ˜¯ä¸“ä¸º **CesiumJS** è®¾è®¡çš„å¼€æºçŸ¢é‡ç“¦ç‰‡æ¸²æŸ“åº“ã€‚åŸç”Ÿ Primitive å®ç°ï¼Œ**ä¸ä¾èµ– ImageryProvider å’Œ ç¬¬ä¸‰æ–¹çŸ¢é‡ç“¦ç‰‡æ¸²æŸ“å™¨**ï¼Œæ”¯æŒ MVT/PBF ä¸ GeoJSONï¼Œå…¼å®¹ MapLibre æ ·å¼è§„èŒƒï¼Œå¯æ¸²æŸ“çº¿/é¢/æ–‡å­—ï¼Œæ”¯æŒè™šçº¿ã€è´´åœ°ã€åˆæ‰¹ä¼˜åŒ–ä¸ GPU å‰”é™¤ã€‚

#### âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **åŸç”Ÿ Cesium æ¸²æŸ“**ï¼šä½¿ç”¨ `Primitive`ã€`PolylineGeometry` å’Œè‡ªå®šä¹‰ `Appearance`ï¼Œæ·±åº¦é›†æˆ Cesium æ¸²æŸ“ç®¡çº¿
- âœ… **å¤šæºæ”¯æŒ**ï¼šåŠ è½½ **MVT (PBF)** çŸ¢é‡ç“¦ç‰‡ æˆ– **GeoJSON** æ•°æ®ï¼ˆé€šè¿‡ `geojson-vt` åŠ¨æ€åˆ‡ç‰‡ï¼‰
- âœ… **MapLibre æ ·å¼å…¼å®¹**ï¼šå®Œæ•´è§£æ `maplibre-gl-style-spec` çš„æ ·å¼è¡¨è¾¾å¼ï¼ˆé¢œè‰²ã€é€æ˜åº¦ã€çº¿å‹ã€æ–‡æœ¬ç­‰ï¼‰
- âœ… **ä¸°å¯Œå›¾å±‚ç±»å‹**ï¼šæ”¯æŒ `background` / `fill` / `line` / `symbol` å››å¤§åŸºç¡€å›¾å±‚ï¼Œå«**è™šçº¿**ï¼ˆ`line-dasharray`ï¼‰ã€æœ¬åœ°å­—ä½“ã€æ–‡å­—å¤§å°ã€æ˜¾éšæ§åˆ¶
- âœ… **ä¸‰ç»´åœºæ™¯èåˆ**ï¼šå¯ä¸ `Entity`ã€`Model`ã€è´´åœ°çº¿/é¢ç­‰ Cesium å¯¹è±¡å…±å­˜ï¼Œå®ç°çœŸä¸‰ç»´ GIS å¯è§†åŒ–
- âœ… **é«˜æ€§èƒ½æ¸²æŸ“**ï¼šæŒ‰å›¾å±‚åˆæ‰¹æ„å»ºå‡ ä½•ä½“ï¼Œé€šè¿‡ `DrawCommand` çš„ `offset/count` å¤ç”¨ bufferï¼Œæ˜¾è‘—æå‡å¸§ç‡
- âœ… **GPU ç²¾å‡†å‰”é™¤**ï¼šåˆ©ç”¨ FBO + RTT æŠ€æœ¯ç”Ÿæˆç“¦ç‰‡ ID çº¹ç†ï¼Œåœ¨ GPU ä¸­é«˜æ•ˆå‰”é™¤ä¸å¯è§çŸ¢é‡ç‰‡æ®µ
- âœ… **é«˜åº¦å¯æ‰©å±•**ï¼šæä¾›æ¸…æ™°æ¥å£ï¼Œè½»æ¾æ¥å…¥æ–°æ•°æ®æºï¼ˆå¦‚ TopoJSONï¼‰æˆ–è‡ªå®šä¹‰å›¾å±‚ç±»å‹ï¼ˆå¦‚çƒ­åŠ›å›¾ã€æµçº¿ï¼‰

#### ğŸ§  æŠ€æœ¯æ ˆäº®ç‚¹

- è§£æï¼š`@mapbox/vector-tile` + `@maplibre/vt-pbf`
- åˆ‡ç‰‡ï¼š`geojson-vt`
- æ ·å¼ï¼š`@maplibre/maplibre-gl-style-spec`
- æŠ•å½±ä¸ç»†åˆ†ï¼šå¤ç”¨ `maplibre-gl` çš„çº¿/é¢æŠ•å½±é€»è¾‘
- æ–‡å­—æ¸²æŸ“ï¼š`Cesium.LabelCollection`
- æ¸²æŸ“ä¼˜åŒ–ï¼šè‡ªå®šä¹‰ `Appearance` + åˆæ‰¹ `DrawCommand` + GPU å‰”é™¤

---

> ğŸ“¦ **Apache-2.0 è®¸å¯è¯ Â· æ¬¢è¿è´¡çŒ® Â· ç”± [mesh-3d](https://github.com/mesh-3d) ç¤¾åŒºç»´æŠ¤**

---

#### ğŸ“œ è®¸å¯è¯å˜æ›´ï¼šMIT â†’ Apache License 2.0

ä» **0.3.0 ç‰ˆæœ¬**èµ·ï¼Œæœ¬é¡¹ç›®å·²å°†è®¸å¯è¯ç”± **MIT è®¸å¯è¯** æ›´æ”¹ä¸º **Apache License 2.0**ã€‚

æ­¤æ¬¡å˜æ›´æ—¨åœ¨ï¼š
- ä¸ºè´¡çŒ®è€…å’Œç”¨æˆ·æä¾›æ˜ç¡®çš„**ä¸“åˆ©æˆæƒä¸ä¿æŠ¤**ï¼Œ
- å¯¹**å•†ä¸šä½¿ç”¨å’Œå†åˆ†å‘**æä¾›æ›´æ¸…æ™°çš„æ³•å¾‹æ¡æ¬¾ï¼Œ
- ä¸ç›¸å…³åœ°ç†ç©ºé—´é¡¹ç›®ï¼ˆå¦‚ CesiumJSï¼‰çš„è®¸å¯ç­–ç•¥ä¿æŒä¸€è‡´ã€‚

Apache 2.0 ä»æ˜¯ä¸€ä¸ª**å®½æ¾ä¸”å¯¹å•†ä¸šå‹å¥½çš„è®¸å¯è¯**â€”â€”æ‚¨ä¾ç„¶å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æœ¬è½¯ä»¶ï¼ˆåŒ…æ‹¬ç”¨äºä¸“æœ‰äº§å“ï¼‰ï¼Œåªéœ€ä¿ç•™åŸå§‹ç‰ˆæƒå£°æ˜å’Œå…è´£å£°æ˜å³å¯ã€‚

æœ¬æ¬¡å˜æ›´åçš„æ–°è´¡çŒ®å‡éµå¾ª Apache 2.0 æ¡æ¬¾ã€‚æ­¤å‰å‘å¸ƒçš„ç‰ˆæœ¬ï¼ˆMIT è®¸å¯ï¼‰ä»æŒ‰å…¶åŸå§‹è®¸å¯è¯æ¡æ¬¾ç»§ç»­æœ‰æ•ˆã€‚

è¯¦æƒ…è¯·å‚è§ [LICENSE](./LICENSE.md) æ–‡ä»¶ã€‚

## æ„å»º

å®‰è£… vite ç­‰å¼€å‘ä¾èµ–é¡¹

```shell
npm install --save-dev
```

ç„¶åå¯ä»¥è¿è¡Œæ„å»ºå‘½ä»¤

```shell
npm run build
```

æºç è°ƒè¯•

```shell
npm run dev
```

## å®‰è£…

```shell
npm install @mesh3d/cesium-vectortile-gl
```

## ä½¿ç”¨

```js
import { VectorTileset } from "@mesh3d/cesium-vectortile-gl";

const tileset = new VectorTileset({
  style: "/assets/demotiles/style.json",
});

viewer.scene.primitives.add(tileset);
```

**æ³¨æ„**ï¼šè¯·ç¡®ä¿é€šè¿‡`window.Cesium`èƒ½å¤Ÿè®¿é—®åˆ°å¯ç”¨çš„ Cesium åŒ…ï¼Œä¾‹å¦‚ï¼š

```js
import * as Cesium from "cesium";
window.Cesium = Cesium;
```

æˆ–è€…åœ¨ html ä¸­é€šè¿‡`script`æ ‡ç­¾å¼•å…¥ Cesium.jsï¼Œä¾‹å¦‚

```html
<script src="libs/cesium/Build/CesiumUnminified/Cesium.js"></script>
```

## æ‰©å±•

å¯ä»¥é€šè¿‡å®ç°ç»Ÿä¸€çš„æ¥å£ï¼Œå¯¹å›¾å±‚ç±»å‹å’Œæ•°æ®æºç±»å‹ä¸¤å¤§æ¨¡å—çš„è¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ï¼Œä»¥æ”¯æŒæ›´å¤š Maplibre è§„èŒƒçš„æ•°æ®æºç±»å‹å’Œå›¾å±‚æ ·å¼ã€‚

#### æ‰©å±•å›¾å±‚ç±»å‹

æ‰©å±•æ”¯æŒæ–°çš„å›¾å±‚ç±»å‹ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

- **ç®€å•æ‰©å±•** åªæ‰©å±•**æ¸²æŸ“å›¾å±‚ç±»**ï¼Œé€šè¿‡ç»§æ‰¿å’Œé‡å†™å…³é”®æ–¹æ³•çš„æ–¹å¼å®ç°**IRenderLayer**æ¥å£ï¼Œæ¯ä¸ªå›¾å±‚å¯¹åº”ä¸€ä¸ªæ¸²æŸ“å›¾å…ƒï¼ˆPrimitiveï¼‰ï¼Œè¿™ç§æ–¹å¼é€‚åˆç¡®å®šå›¾å±‚å®ä¾‹æå°‘çš„æƒ…å†µï¼Œæ˜¯å¦å¤ç”¨ç¼“å†²åŒºå¯¹æ€§èƒ½çš„å½±å“ä¸å¤§ï¼Œå¯ä»¥å‚è€ƒ background å›¾å±‚æ¸²æŸ“ç±»**BackgroundRenderLayer**å®ç°ï¼›

- **é«˜çº§æ‰©å±•** æ‰©å±•**æ¸²æŸ“å›¾å±‚ç±»**å’Œ**å›¾å±‚æ¸²æŸ“å™¨**ï¼Œå®ç°**IRenderLayer**å’Œ**ILayerVisualizer**æ¥å£ã€‚**å›¾å±‚æ¸²æŸ“å™¨**è´Ÿè´£ç“¦ç‰‡å†…æŒ‡å®šç±»å‹å›¾å±‚çš„åˆæ‰¹å‡ ä½•ä½“ã€æ‰¹æ¬¡è¡¨ã€ç»˜å›¾å‘½ä»¤ï¼ˆDrawCommandï¼‰çš„æ„å»ºï¼Œä»¥åŠå›¾å±‚ DrawCommand æµ…æ‹·è´å‰¯æœ¬ï¼ˆshallow cloneï¼‰çš„åˆ†é…ï¼›**æ¸²æŸ“å›¾å±‚ç±»**åªè´Ÿè´£æ›´æ–°å›¾å±‚çŠ¶æ€ï¼ˆä¾‹å¦‚åŒæ­¥å›¾å±‚æ ·å¼ï¼‰ã€‚å¦‚æœå›¾å±‚å®ä¾‹æ•°é‡ä¸ç¡®å®šæˆ–è€…å¾ˆå¤§ï¼Œæ¯ä¸ªå›¾å±‚å®ä¾‹ç‹¬å ä¸€ä¸ªé¡¶ç‚¹ç¼“å†²åŒºå’Œç´¢å¼•ç¼“å†²åŒºï¼Œæ€§èƒ½æŸè€—å°†å¾ˆå¤§ï¼Œ**åº”è¯¥**é‡‡ç”¨è¿™ç§æ–¹å¼è¿›è¡Œæ‰©å±•ï¼Œç¡®ä¿**æµç•…æ¸²æŸ“**ã€‚å¯ä»¥å‚è€ƒ**FillRenderLayer**å’Œ**FillLayerVisualizer**çš„å®ç°ã€‚

ç¼–å†™æ‰©å±•ç±»åï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼æ³¨å†Œï¼š

```js
import { registerRenderLayer } from "@mesh3d/cesium-vectortile-gl";
//ç®€å•æ‰©å±•
registerRenderLayer("layerType", XXXRenderLayer);

//é«˜çº§æ‰©å±•
registerRenderLayer("fill", FillRenderLayer, FillLayerVisualizer);
```

- `ç¬¬ä¸€ä¸ªå‚æ•°`ä¸ºå›¾å±‚ç±»å‹åç§°ï¼Œå¦‚ circleï¼Œ**å¿…é€‰**
- `ç¬¬äºŒä¸ªå‚æ•°`ä¸ºå›¾å±‚æ¸²æŸ“ç±»ï¼Œ**å¿…é€‰**
- `ç¬¬ä¸‰ä¸ªå‚æ•°`ä¸ºå›¾å±‚æ¸²æŸ“å™¨ç±»ï¼Œ**å¯é€‰**ï¼Œä»…æ³¨å†Œé«˜çº§æ‰©å±•æ—¶éœ€è¦ä¼ é€’

#### æ‰©å±•æ•°æ®æºç±»å‹

æ•°æ®ç±»å‹çš„æ‰©å±•é‡‡ç”¨é¢å‘æ¥å£ï¼Œåªéœ€è¦æŒ‰`ISource`çš„çº¦å®šç¼–å†™å¿…é¡»å®ç°çš„æ–¹æ³•ï¼ˆinitã€requestTileï¼‰å³å¯ã€‚

- **constructor(styleSource, path = '')** æ„é€ å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ¥æ”¶æ•°æ®æºé…ç½®ï¼Œç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶æ ·å¼è·¯å¾„ï¼ˆå¦‚æœ style ä¼ å…¥ url çš„è¯ï¼‰ï¼Œå¯ä»¥ç”¨äºæ”¯æŒç›¸å¯¹è·¯å¾„
- **init** åˆå§‹åŒ–æ•°æ®æº
- **requestTile** è¯·æ±‚ç“¦ç‰‡ï¼Œå¼‚æ­¥è¿”å› @mapbox/vector-tile çš„ VectorTile ç±»å‹æˆ–è€…ä¸è¯¥ç±»å…·æœ‰ä¸€è‡´æ¥å£çš„ç±»å‹
- **destroy** é”€æ¯å®ä¾‹ï¼Œé‡Šæ”¾å†…éƒ¨åˆ›å»ºçš„èµ„æº

ç¼–å†™æ‰©å±•ç±»åï¼Œé€šè¿‡å¦‚ä¸‹æ–¹å¼æ³¨å†Œï¼š

```js
import { registerSource } from "@mesh3d/cesium-vectortile-gl";

registerSource("sourceType", XXXSource);
```

- `ç¬¬ä¸€ä¸ªå‚æ•°`ä¸ºæ•°æ®æºç±»å‹åç§°ï¼Œå¦‚ rasterï¼Œ**å¿…é€‰**
- `ç¬¬äºŒä¸ªå‚æ•°`ä¸ºæ•°æ®æºç±»ï¼Œ**å¿…é€‰**

## ä¾èµ–

æœ¬é¡¹ç›®ä¾èµ–ï¼š

- [@mapbox/vector-tile](https://github.com/mapbox/vector-tile-js)(BSD-3-Clause)
- [@maplibre/maplibre-gl-style-spec](https://github.com/maplibre/maplibre-style-spec)(ISC)
- [@maplibre/vt-pbf](https://github.com/maplibre/vt-pbf)(MIT)
- [geojson-vt](https://github.com/mapbox/geojson-vt)(ISC)
- [maplibre-gl](https://github.com/maplibre/maplibre-gl-js)(BSD-3-Clause)
- [pbf](https://github.com/mapbox/pbf)(BSD-3-Clause)

## ç›¸å…³é¡¹ç›®

- [CesiumVectorTile](https://github.com/MikesWei/CesiumVectorTile) - åŸºäº ImageryProvider çš„è½»é‡ç‰ˆ
- [Mesh-3D](http://mesh-3d.com) - ä¼ä¸šçº§ Web3D å¼•æ“ï¼ˆæä¾›å•†ä¸šæ”¯æŒå’Œé«˜çº§åŠŸèƒ½ï¼‰

æ›´å¤šæŠ€æœ¯æ–‡ç« åŠæ¡ˆä¾‹ï¼Œæ•¬è¯·å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€**Mesh-3D**ã€‘
![Mesh-3Då¾®ä¿¡å…¬ä¼—å·](http://www.mesh-3d.com/articles/å¾®ä¿¡å…¬ä¼—å·ã€Mesh-3Dã€‘.png)

## æ•ˆæœå›¾

![æ•ˆæœå›¾1](http://www.mesh-3d.com/cvt-gl/assets/images/screenshot.jpg)
![æ•ˆæœå›¾2](http://www.mesh-3d.com/cvt-gl/assets/images/screenshot2.jpg)
